var h=globalThis.chrome,Fe=typeof browser<"u",o=Fe?browser:h,ne=typeof h<"u"&&"sidePanel"in h,A=typeof browser<"u"&&typeof browser.sidebarAction?.open=="function",se=typeof h<"u"&&typeof h.storage<"u"&&"session"in h.storage,Ve=typeof h<"u"&&typeof h.action?.openPopup=="function",Ue=typeof h<"u"&&"alarms"in h;var y="__session:";function oe(e){return typeof e=="string"?[`${y}${e}`]:Array.isArray(e)?e.map(t=>`${y}${t}`):Object.keys(e).map(t=>`${y}${t}`)}function ie(e){let t={};for(let[n,s]of Object.entries(e))t[`${y}${n}`]=s;return t}function He(e){let t={};for(let[n,s]of Object.entries(e))n.startsWith(y)&&(t[n.slice(y.length)]=s);return t}var N=new Set,re=!1;function Ge(){re||(re=!0,o.storage.local.onChanged.addListener(e=>{if(N.size===0)return;let t={},n=!1;for(let[s,r]of Object.entries(e))s.startsWith(y)&&(t[s.slice(y.length)]=r,n=!0);if(n)for(let s of N)s(t,"session")}))}var ze={get(e,t){let n=e===null?null:oe(e);o.storage.local.get(n,s=>{t(He(s))})},set(e,t){t?o.storage.local.set(ie(e),t):o.storage.local.set(ie(e))},remove(e,t){let n=oe(e);t?o.storage.local.remove(n,t):o.storage.local.remove(n)},clear(e){o.storage.local.get(null,t=>{let n=Object.keys(t).filter(s=>s.startsWith(y));n.length>0?e?o.storage.local.remove(n,e):o.storage.local.remove(n):e?.()})},onChanged:{addListener(e){Ge(),N.add(e)}}};function Ke(){let e=o.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var g={local:o.storage.local,session:se?Ke():ze,onChanged:o.storage.onChanged};function je(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{g.session.set({sidebarSessionId:t},n)}),e&&await o.sidePanel.open({windowId:e})}}}function Qe(){return{isSupported:!0,async open({sessionId:e}){await browser.sidebarAction.open(),e&&g.session.set({sidebarSessionId:e})}}}var Y=ne?je():Qe();var Mt=1/30;var k="themeMode";function ce(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function _(e){document.documentElement.setAttribute("data-theme",e)}function ae(e){return e==="auto"?ce():e}function de(){g.local.get(k,t=>{let n=t[k]||"auto";_(ae(n))}),g.local.onChanged.addListener(t=>{if(t[k]){let n=t[k].newValue||"auto";_(ae(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{g.local.get(k,t=>{(t[k]||"auto")==="auto"&&_(ce())})})}var Ze="https://api.dropcal.ai",S="auth",ve=document.getElementById("view-auth"),P=document.getElementById("view-input"),ye=document.getElementById("view-settings"),Z=document.getElementById("popup-header"),m=document.getElementById("drop-zone"),W=document.getElementById("drop-zone-content"),X=document.getElementById("drop-zone-success"),q=document.getElementById("drop-zone-error"),J=document.getElementById("feedback-actions"),Ee=[ve,P,ye];function le(){m.classList.remove("processing","success","error"),W.classList.remove("hidden"),X.classList.add("hidden"),q.classList.add("hidden"),J.classList.add("hidden")}function p(e){for(let t of Ee)t.classList.add("hidden");Z.classList.toggle("hidden",e==="auth"||e==="settings"),e==="auth"?ve.classList.remove("hidden"):e==="input"?(P.classList.remove("hidden"),le()):e==="processing"?(P.classList.remove("hidden"),le(),m.classList.add("processing")):e==="settings"&&ye.classList.remove("hidden"),S=e}var We=document.getElementById("header-brand");We.addEventListener("click",e=>{e.preventDefault(),o.tabs.create({url:"https://dropcal.ai"})});var Xe=document.getElementById("btn-settings");Xe.addEventListener("click",()=>{Q=S,p("settings"),T="main",R("main"),vt()});var qe=document.getElementById("btn-signin");qe.addEventListener("click",()=>{o.runtime.sendMessage({type:"SIGN_IN"}),window.close()});var Se=document.getElementById("btn-link"),be=document.getElementById("btn-images"),Le=document.getElementById("btn-files"),ke=document.getElementById("btn-center"),Ie=document.getElementById("btn-audio"),we=document.getElementById("btn-text"),Ce=document.getElementById("btn-email"),Je=[Se,be,Le,ke,Ie,we,Ce],V=document.getElementById("results-section"),D=document.getElementById("results-list");for(let e of Je)e.addEventListener("click",t=>t.stopPropagation());function L(e){o.tabs.create({url:`https://dropcal.ai?input=${e}`}),window.close()}Se.addEventListener("click",()=>L("link"));be.addEventListener("click",()=>L("image"));Le.addEventListener("click",()=>L("document"));ke.addEventListener("click",()=>L("upload"));Ie.addEventListener("click",()=>L("audio"));we.addEventListener("click",()=>L("text"));Ce.addEventListener("click",()=>L("email"));m.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),m.classList.add("dragging")});m.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging")});m.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging");let t=e.dataTransfer;if(!t)return;if(t.files&&t.files.length>0){_e(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&Ye(n.trim())});document.addEventListener("paste",e=>{if(S!=="input")return;let t=e.clipboardData;if(!t)return;if(t.files&&t.files.length>0){_e(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&Ye(n.trim())});var ue={text:"ph-pencil-simple",image:"ph-images",page:"ph-globe",file:"ph-files"};function et(e){return e.icon?`ph-${e.icon}`:ue[e.inputType]||ue.text}var U=new Set,$=new Map;function tt(e,t,n=25){let s=0;e.textContent="",e.classList.add("typing-cursor");let r=setInterval(()=>{s<t.length?e.textContent=t.substring(0,++s):(clearInterval(r),e.classList.remove("typing-cursor"))},n)}function nt(e){let n=Math.floor((new Date().getTime()-e)/(1e3*60*60*24));return n===0?"Today":n===1?"Yesterday":n<=7?"7 Days":n<=30?"30 Days":"Older"}function st(e){return e.filter(t=>t.status==="error"?!1:t.status==="polling"?!0:t.eventCount>0)}function ot(e=5){V.classList.remove("hidden"),D.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-row",n.innerHTML='<div class="skeleton-icon"></div><div class="skeleton-title"></div>',D.appendChild(n)}}function Pe(e){let t=st(e);if(t.length===0){V.classList.add("hidden");return}V.classList.remove("hidden"),D.innerHTML="";let n=new Map,s=["Today","Yesterday","7 Days","30 Days","Older"];for(let r of t){let i=nt(r.createdAt);n.has(i)||n.set(i,[]),n.get(i).push(r)}for(let r of s){let i=n.get(r);if(!i||i.length===0)continue;let a=document.createElement("div");a.className="session-group";let E=document.createElement("div");E.className="session-group-label",E.textContent=r,a.appendChild(E);for(let c of i){let f=document.createElement("div");f.className="session-row",f.addEventListener("click",()=>Oe(c.sessionId));let v=document.createElement("i");v.className=`session-icon ph ${et(c)}`;let l=document.createElement("div");if(l.className="session-row-title",c.status==="polling"&&!c.title?l.innerHTML='<div class="skeleton-title"></div>':c.title?$.get(c.sessionId)===null&&!U.has(c.sessionId)?(U.add(c.sessionId),tt(l,c.title)):l.textContent=c.title:l.textContent="Untitled",c.status==="polling"&&l.classList.add("processing"),f.appendChild(v),f.appendChild(l),c.status==="polling"){let u=document.createElement("div");u.className="processing-indicator",f.appendChild(u)}else if(c.eventCount>0){let u=document.createElement("div");u.className=`event-count-badge${c.addedToCalendar?"":" unsynced"}`,u.textContent=String(c.eventCount),f.appendChild(u)}a.appendChild(f)}D.appendChild(a)}for(let r of e)$.set(r.sessionId,r.title)}var ge=document.getElementById("feedback-icon"),it=document.getElementById("feedback-title"),pe=document.getElementById("feedback-subtitle"),H=document.getElementById("feedback-error-icon"),G=document.getElementById("feedback-error-title"),I=document.getElementById("feedback-error-subtitle"),ee=document.getElementById("btn-dismiss-success"),te=document.getElementById("btn-dismiss-error"),d=null,x=new Set,rt=24*60*60*1e3;function at(e){return!(e.status!=="processed"&&e.status!=="error"||e.dismissedAt||x.has(e.sessionId)||Date.now()-e.createdAt>rt)}function z(e,t){for(let n=t.length-1;n>=0;n--){let s=e.find(r=>r.sessionId===t[n]);if(s&&at(s))return s}return null}function ct(e){d=e.sessionId,e.icon?ge.className=`ph-duotone ph-${e.icon} feedback-icon feedback-icon-success`:ge.className="ph-duotone ph-check-fat feedback-icon feedback-icon-success";let t=e.eventCount;it.textContent=t===1?"1 Event Scheduled":`${t} Events Scheduled`,pe.textContent=e.title||"",pe.classList.toggle("hidden",!e.title),m.classList.remove("processing","error"),m.classList.add("success"),W.classList.add("hidden"),q.classList.add("hidden"),X.classList.remove("hidden"),ee.classList.remove("hidden"),te.classList.add("hidden"),J.classList.remove("hidden"),P.classList.remove("hidden"),Z.classList.remove("hidden"),S="input"}function xe(){m.classList.remove("processing","success"),m.classList.add("error"),W.classList.add("hidden"),X.classList.add("hidden"),q.classList.remove("hidden"),ee.classList.add("hidden"),te.classList.remove("hidden"),J.classList.remove("hidden"),P.classList.remove("hidden"),Z.classList.remove("hidden"),S="input"}function M(e){d=null,H.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",G.textContent=e,I.textContent="",I.classList.add("hidden"),xe()}function Te(e){d=e.sessionId,e.status==="processed"&&e.eventCount===0?(H.className="ph-duotone ph-calendar-blank feedback-icon feedback-icon-error",G.textContent="No Events Found",I.textContent=e.title||"No calendar events were detected."):(H.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",G.textContent="Processing Failed",I.textContent=e.errorMessage||""),I.classList.toggle("hidden",!I.textContent),xe()}function K(e){e.status==="error"||e.eventCount===0?Te(e):ct(e)}m.addEventListener("click",async()=>{if(m.classList.contains("success")&&d){let e=d;d=null,x.add(e),await Oe(e),await new Promise(t=>{o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:e},()=>t())}),window.close()}else m.classList.contains("error")&&d&&(x.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null,p("input"),b())});ee.addEventListener("click",e=>{e.stopPropagation(),d&&(x.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d})),d=null,p("input"),b()});te.addEventListener("click",()=>{d&&(x.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null),p("input"),b()});var T="main",w="MM/DD/YYYY",C="auto",j=[],me="free",Q="input",dt=document.getElementById("settings-back-btn"),lt=document.getElementById("settings-user-email"),ut=document.getElementById("settings-main"),gt=document.getElementById("settings-integrations-view"),fe=document.getElementById("settings-providers-list"),Me=document.getElementById("settings-upgrade"),pt=document.getElementById("settings-date-format"),he=document.getElementById("settings-date-icon"),mt=document.getElementById("settings-date-value"),ft=document.getElementById("settings-theme"),O=document.getElementById("settings-theme-icon"),F=document.getElementById("settings-theme-label"),ht=document.getElementById("settings-integrations-btn"),De=document.getElementById("settings-logout"),Re=document.getElementById("settings-disconnect-btn"),Be=document.getElementById("settings-disconnect-back");function R(e){T=e,ut.classList.toggle("hidden",e!=="main"),gt.classList.toggle("hidden",e==="main"),De.classList.toggle("hidden",e!=="main"),Re.classList.toggle("hidden",e!=="integrations"),Be.classList.toggle("hidden",e!=="disconnect")}function vt(){o.runtime.sendMessage({type:"GET_USER_PROFILE"},e=>{if(e?.ok&&e.profile){let t=e.profile;lt.textContent=t.email||"",me=t.plan==="pro"?"pro":"free",w=t.preferences?.date_format==="DD/MM/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",C=["auto","light","dark"].includes(t.preferences?.theme_mode)?t.preferences.theme_mode:"auto";let n=Me.querySelector("span");n.textContent=me==="pro"?"Manage subscription":"Upgrade plan",Ae(),Ne()}})}function Ae(){mt.textContent=w,w==="DD/MM/YYYY"?he.className="ph ph-globe-simple settings-item-icon":he.className="ph ph-football-helmet settings-item-icon"}function Ne(){C==="auto"?(O.className="ph ph-flashlight settings-item-icon",F.textContent="Auto theme"):C==="dark"?(O.className="ph ph-moon-stars settings-item-icon",F.textContent="Dark mode"):(O.className="ph ph-sun-horizon settings-item-icon",F.textContent="Light mode")}function yt(){o.runtime.sendMessage({type:"GET_CALENDAR_PROVIDERS"},e=>{e?.ok&&e.providers&&(j=e.providers,B())})}function B(){fe.innerHTML="";let e=[{key:"google",name:"Google",iconClass:"ph ph-google-logo"},{key:"microsoft",name:"Outlook",iconClass:"ph ph-microsoft-outlook-logo"},{key:"apple",name:"Apple",iconClass:"ph ph-apple-logo"}];for(let t of e){let n=j.find(l=>l.provider===t.key),s=n?.connected??!1,r=n?.is_primary??!1,i=T==="disconnect",a=document.createElement("button");a.className="settings-item settings-integration-row",s&&r&&!i&&a.classList.add("settings-integration-active");let E=document.createElement("i");E.className=`${t.iconClass} settings-item-icon`;let c=document.createElement("div");c.className="settings-integration-info";let f=document.createElement("span");f.className="settings-integration-name",f.textContent=t.name;let v=document.createElement("span");if(v.className="settings-integration-detail",s?i?(v.textContent="Disconnect",v.style.color="var(--error)"):v.textContent=n?.email||"":(v.textContent=i?"Not connected":"Connect",i&&(a.style.opacity="0.4",a.style.cursor="default")),c.appendChild(f),c.appendChild(v),a.appendChild(E),a.appendChild(c),s){let l=document.createElement("div");if(l.className="settings-integration-actions",i){let u=document.createElement("i");u.className="ph ph-sign-out",u.style.color="var(--error)",l.appendChild(u)}else{let u=document.createElement("i");u.className=r?"ph ph-star settings-star-active":"ph ph-star settings-star-inactive",l.appendChild(u)}a.appendChild(l)}s&&i?a.addEventListener("click",()=>{o.runtime.sendMessage({type:"DISCONNECT_PROVIDER",provider:t.key},l=>{l?.ok&&yt()})}):s?a.addEventListener("click",()=>{o.runtime.sendMessage({type:"SET_PRIMARY_PROVIDER",provider:t.key},l=>{if(l?.ok){for(let u of j)u.is_primary=u.provider===t.key;B()}})}):i||a.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai"})}),fe.appendChild(a)}}dt.addEventListener("click",()=>{T==="integrations"||T==="disconnect"?R("main"):(p(Q),Q==="input"&&b())});Me.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai/plans"})});pt.addEventListener("click",()=>{w=w==="MM/DD/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",Ae(),o.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{date_format:w}})});ft.addEventListener("click",()=>{let e=["auto","light","dark"],t=e.indexOf(C);C=e[(t+1)%3],Ne(),o.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{theme_mode:C}})});ht.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai/?settings=integrations"}),window.close()});De.addEventListener("click",()=>{o.runtime.sendMessage({type:"SIGN_OUT"},()=>{p("auth")})});Re.addEventListener("click",()=>{R("disconnect"),B()});Be.addEventListener("click",()=>{R("integrations"),B()});function Ye(e){p("processing"),o.runtime.sendMessage({type:"SUBMIT_TEXT",text:e},t=>{t&&!t.ok?M(t.error||"Failed to process text"):window.close()})}async function _e(e){p("processing");let n=(await new Promise(s=>{g.local.get("auth",r=>s(r))})).auth?.accessToken;if(!n){M("Not authenticated. Please sign in.");return}for(let s of Array.from(e))try{let r=new FormData;r.append("file",s);let i=await fetch(`${Ze}/upload`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:r});if(!i.ok){let E=await i.json().catch(()=>({error:"Upload failed"}));M(E.error||`Upload failed (${i.status})`);return}let{session:a}=await i.json();o.runtime.sendMessage({type:"TRACK_SESSION",sessionId:a.id,inputType:s.type.startsWith("image/")?"image":"file"})}catch{M("Failed to upload file");return}window.close()}async function Oe(e){if(A){browser.sidebarAction.open(),g.session.set({sidebarSessionId:e});return}await new Promise(n=>{g.session.set({sidebarSessionId:e},n)});let t=await o.windows.getCurrent();t.id&&await Y.open({windowId:t.id,sessionId:e})}function Et(e,t){if(S==="processing"){let n=z(e,t);if(n){K(n);return}if(!e.some(s=>s.status==="polling")){let s=e[0];s&&(s.status==="error"||s.status==="processed"&&s.eventCount===0)?Te(s):p("input")}return}if(S==="input"){let n=z(e,t);n&&d!==n.sessionId&&K(n)}}function b(){g.local.get(["sessionHistory","notificationQueue"],e=>{let t=e.sessionHistory?.sessions||[],n=e.notificationQueue||[];Pe(t),Et(t,n)})}g.local.onChanged.addListener(e=>{(e.sessionHistory||e.notificationQueue)&&b(),e.auth&&o.runtime.sendMessage({type:"GET_AUTH"},t=>{t?.isAuthenticated?(p("input"),b()):p("auth")})});g.session.onChanged.addListener(()=>{b()});de();o.runtime.sendMessage({type:"GET_AUTH"},e=>{if(!(e?.isAuthenticated??!1)){p("auth");return}p("input"),ot(),g.local.get(["sessionHistory","notificationQueue"],n=>{let s=n.sessionHistory?.sessions||[],r=n.notificationQueue||[];for(let i of s)$.set(i.sessionId,i.title),i.title&&U.add(i.sessionId);if(s.some(i=>i.status==="polling"))p("processing");else{let i=z(s,r);if(i){for(let a of Ee)a.classList.add("hidden");K(i)}else p("input")}Pe(s)})});
//# sourceMappingURL=popup.js.map
