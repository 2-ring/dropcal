var i=globalThis.chrome,Y=typeof browser<"u",s=Y?browser:i,w=typeof i<"u"&&"sidePanel"in i,q=typeof browser<"u"&&typeof browser.sidebarAction?.open=="function",R=typeof i<"u"&&typeof i.storage<"u"&&"session"in i.storage,E=typeof i<"u"&&"notifications"in i,G=typeof i<"u"&&typeof i.action?.openPopup=="function",X=typeof i<"u"&&"alarms"in i;var c="__session:";function A(e){return typeof e=="string"?[`${c}${e}`]:Array.isArray(e)?e.map(t=>`${c}${t}`):Object.keys(e).map(t=>`${c}${t}`)}function I(e){let t={};for(let[n,o]of Object.entries(e))t[`${c}${n}`]=o;return t}function J(e){let t={};for(let[n,o]of Object.entries(e))n.startsWith(c)&&(t[n.slice(c.length)]=o);return t}var x=new Set,M=!1;function Z(){M||(M=!0,s.storage.local.onChanged.addListener(e=>{if(x.size===0)return;let t={},n=!1;for(let[o,g]of Object.entries(e))o.startsWith(c)&&(t[o.slice(c.length)]=g,n=!0);if(n)for(let o of x)o(t,"session")}))}var ee={get(e,t){let n=e===null?null:A(e);s.storage.local.get(n,o=>{t(J(o))})},set(e,t){t?s.storage.local.set(I(e),t):s.storage.local.set(I(e))},remove(e,t){let n=A(e);t?s.storage.local.remove(n,t):s.storage.local.remove(n)},clear(e){s.storage.local.get(null,t=>{let n=Object.keys(t).filter(o=>o.startsWith(c));n.length>0?e?s.storage.local.remove(n,e):s.storage.local.remove(n):e?.()})},onChanged:{addListener(e){Z(),x.add(e)}}};function te(){let e=s.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var a={local:s.storage.local,session:R?te():ee,onChanged:s.storage.onChanged};var ne={create(e,t){E&&s.notifications.create(e,t)},onClicked:E?s.notifications.onClicked:{addListener:e=>{}}};function oe(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{a.session.set({sidebarSessionId:t},n)}),e&&await s.sidePanel.open({windowId:e})}}}function se(){return{isSupported:!0,async open({sessionId:e}){await browser.sidebarAction.open(),e&&a.session.set({sidebarSessionId:e})}}}var re=w?oe():se();var ke=1/30;var f="themeMode";function $(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function P(e){document.documentElement.setAttribute("data-theme",e)}function N(e){return e==="auto"?$():e}function O(){a.local.get(f,t=>{let n=t[f]||"auto";P(N(n))}),a.local.onChanged.addListener(t=>{if(t[f]){let n=t[f].newValue||"auto";P(N(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{a.local.get(f,t=>{(t[f]||"auto")==="auto"&&P($())})})}var H=document.getElementById("sidebar-title"),ae=document.getElementById("state-loading"),ie=document.getElementById("state-events"),de=document.getElementById("state-error"),ce=document.getElementById("state-empty"),B=document.getElementById("skeleton-list"),T=document.getElementById("events-list"),k=document.getElementById("sidebar-error-message"),le=document.getElementById("btn-back"),ge=document.getElementById("btn-open-dropcal"),p=null;function l(e){ae.classList.toggle("hidden",e!=="loading"),ie.classList.toggle("hidden",e!=="events"),de.classList.toggle("hidden",e!=="error"),ce.classList.toggle("hidden",e!=="empty")}function D(e){B.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-card",n.style.opacity=String(1-t*.15),B.appendChild(n)}}function _(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function pe(e,t){return e.date?"All day":e.dateTime&&t.dateTime?`${_(e.dateTime)} - ${_(t.dateTime)}`:""}function L(e){let t=e.start.dateTime||e.start.date||"";return new Date(t)}function me(e){let t=new Map,n=[...e].sort((o,g)=>L(o).getTime()-L(g).getTime());for(let o of n){let d=L(o).toDateString();t.has(d)||t.set(d,[]),t.get(d).push(o)}return t}var fe='<i class="ph-bold ph-map-pin" style="font-size: 16px"></i>',ue='<i class="ph-bold ph-equals" style="font-size: 16px"></i>';function F(e){if(T.innerHTML="",e.length===0){l("empty");return}let t=me(e),n="";t.forEach((o,g)=>{let d=new Date(g),y=d.toLocaleDateString("en-US",{month:"long",...d.getFullYear()!==new Date().getFullYear()&&{year:"numeric"}});if(y!==n){n=y;let r=document.createElement("div");r.className="month-header",r.innerHTML=`<h2 class="month-header-text">${y}</h2>`,T.appendChild(r)}let u=document.createElement("div");u.className="date-group";let K=new Date,j=d.toDateString()===K.toDateString(),z=d.toLocaleDateString("en-US",{weekday:"short"}),V=d.getDate(),S=document.createElement("div");S.className=`date-header${j?" today":""}`,S.innerHTML=`
      <div class="date-day-label">${z}</div>
      <div class="date-circle">
        <span class="date-number">${V}</span>
      </div>
    `;let b=document.createElement("div");b.className="date-events";for(let r of o){let m=document.createElement("div");m.className="event-card";let C=r.calendarColor||"#1170C5";m.style.borderLeftColor=C,m.style.backgroundColor=`${C}12`;let W=pe(r.start,r.end),h=`
        <div class="event-card-title-row">
          <span class="event-card-title">${v(r.summary)}</span>
          <span class="event-card-time">(${W})</span>
        </div>
      `;r.location&&(h+=`
          <div class="event-card-meta">
            ${fe}
            <span>${v(r.location)}</span>
          </div>
        `),r.description&&(h+=`
          <div class="event-card-meta event-card-description">
            ${ue}
            <span>${v(r.description)}</span>
          </div>
        `),r.calendarName&&(h+=`
          <div class="event-calendar-badge">
            <span class="calendar-badge-dot" style="background-color: ${C}"></span>
            <span class="calendar-badge-text">${v(r.calendarName)}</span>
          </div>
        `),m.innerHTML=h,m.addEventListener("click",()=>{p&&s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:p})}),b.appendChild(m)}u.appendChild(S),u.appendChild(b),T.appendChild(u)}),l("events")}function v(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function U(e){p=e,D(3),l("loading"),a.local.get("sessionHistory",t=>{let o=t.sessionHistory?.sessions.find(g=>g.sessionId===e);if(!o){k.textContent="Session not found.",l("error");return}if(H.textContent=o.title||"Events",o.status==="error"){k.textContent=o.errorMessage||"Processing failed.",l("error");return}if(o.status==="polling"){D(3),l("loading");return}o.events&&o.events.length>0?F(o.events):l("empty")})}le.addEventListener("click",()=>{window.close()});ge.addEventListener("click",()=>{p&&s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:p})});a.local.onChanged.addListener(e=>{if(e.sessionHistory&&p){let n=e.sessionHistory.newValue?.sessions.find(o=>o.sessionId===p);n&&(H.textContent=n.title||"Events",n.status==="processed"&&n.events&&n.events.length>0?F(n.events):n.status==="error"&&(k.textContent=n.errorMessage||"Processing failed.",l("error")))}});O();a.session.get("sidebarSessionId",e=>{let t=e.sidebarSessionId;t?U(t):l("empty")});a.session.onChanged.addListener(e=>{if(e.sidebarSessionId){let t=e.sidebarSessionId.newValue;t&&t!==p&&U(t)}});
//# sourceMappingURL=sidebar.js.map
